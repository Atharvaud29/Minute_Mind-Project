{% extends "base.html" %}
{% block content %}
<section class="dashboard-grid">
  <div class="dashboard-intro">
    <h1>ğŸ“‹ Dashboard</h1>
    <p class="lead">Quick overview. Use the left sidebar to jump to Summary, Tasks or Conflicts.</p>
  </div>

  <!-- Database-driven content sections -->
  <div class="dashboard-columns">
    <!-- LEFT STACK (panels targeted by sidebar) -->
    <aside class="left-stack">

      <!-- SUMMARY -->
      <section class="card panel" id="summaryPanel">
        <div class="panel-head"><h2>ğŸ“Œ Recent Meetings</h2></div>
        <div class="panel-body">
          {% if meetings %}
            <div class="meetings-list">
              {% for meeting in meetings %}
                <div class="meeting-item">
                  <h4>{{ meeting.title }}</h4>
                  <p class="meeting-meta">
                    <span class="date">ğŸ“… {{ meeting.date.strftime('%Y-%m-%d') }}</span>
                    {% if meeting.host %}<span class="host">ğŸ‘¤ {{ meeting.host }}</span>{% endif %}
                  </p>
                  {% if meeting.summary %}
                    <p class="summary">{{ meeting.summary[:100] }}{% if meeting.summary|length > 100 %}...{% endif %}</p>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="muted">No meetings yet. Create your first meeting!</p>
          {% endif %}
          
          <div class="panel-actions">
            <a href="{{ url_for('new_meeting') }}" class="btn primary">â• New Meeting</a>
            <a href="{{ url_for('past_meetings') }}" class="btn ghost">ğŸ“š View All</a>
          </div>
        </div>
      </section>

      <!-- TASK ASSIGNED -->
      <section class="card panel" id="tasksPanel">
        <div class="panel-head"><h2>âœ… Tasks - Assigned</h2></div>
        <div class="panel-body">
          <div class="inline-inputs">
            <input id="task_person" placeholder="Assignee" />
            <input id="task_description" placeholder="Task description" />
            <input id="task_deadline" placeholder="Due date" />
            <button class="btn primary" id="addTaskBtn">Add Task</button>
          </div>

          {% if tasks %}
            <div class="table-wrap">
              <table id="tasksTable" class="wide-table">
                <thead>
                  <tr>
                    <th>Assignee</th>
                    <th>Task</th>
                    <th>Deadline</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for task in tasks %}
                  <tr>
                    <td><strong>{{ task.person }}</strong></td>
                    <td>{{ task.task }}</td>
                    <td>{{ task.deadline }}</td>
                    <td>
                      <span class="status-badge status-{{ task.status.lower().replace(' ', '-') }}">
                        {{ task.status }}
                      </span>
                    </td>
                    <td>
                      <a href="{{ url_for('update_task_status', task_id=task.id) }}" class="btn small">
                        ğŸ”„ Update
                      </a>
                      <a href="{{ url_for('delete_task', task_id=task.id) }}" class="btn small danger" 
                         onclick="return confirm('Delete this task?')">ğŸ—‘ï¸</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="muted">No tasks assigned yet.</p>
          {% endif %}
        </div>
      </section>

      <!-- CONFLICTS -->
      <section class="card panel" id="conflictsPanel">
        <div class="panel-head"><h2>âš ï¸ Conflict Detection</h2></div>
        <div class="panel-body">
          <div class="inline-inputs">
            <input id="conf_issue" placeholder="Conflict description" />
            <input id="conf_raised_by" placeholder="Raised by" />
            <select id="conf_severity">
              <option value="Low">ğŸŸ¢ Low</option>
              <option value="Medium">ğŸŸ¡ Medium</option>
              <option value="High">ğŸ”´ High</option>
            </select>
            <button class="btn warning" id="addConflictBtn">Add Conflict</button>
          </div>

          {% if conflicts %}
            <div class="table-wrap">
              <table id="conflictsTable" class="wide-table">
                <thead>
                  <tr>
                    <th>Issue</th>
                    <th>Raised By</th>
                    <th>Severity</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for conflict in conflicts %}
                  <tr>
                    <td>{{ conflict.issue[:50] }}{% if conflict.issue|length > 50 %}...{% endif %}</td>
                    <td><strong>{{ conflict.raised_by }}</strong></td>
                    <td>
                      <span class="severity-badge severity-{{ conflict.severity.lower() }}">
                        {{ conflict.severity }}
                      </span>
                    </td>
                    <td>
                      <a href="{{ url_for('delete_conflict', conflict_id=conflict.id) }}" 
                         class="btn small danger" onclick="return confirm('Delete this conflict?')">ğŸ—‘ï¸</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="muted">No conflicts detected yet.</p>
          {% endif %}
        </div>
      </section>
    </aside>

    <!-- RIGHT COLUMN -->
    <section class="right-column card">
      <div class="tabs-row">
        <button class="tab-btn active" data-tab="transcript">ğŸ“ Transcript</button>
        <button class="tab-btn" data-tab="summaryTab">ğŸ“‹ Summary</button>
        <button class="tab-btn" data-tab="action">âœ… Action</button>
        <button class="tab-btn" data-tab="conflictsTab">âš ï¸ Conflicts</button>
        <button class="tab-btn" data-tab="sentiment">ğŸ˜Š Sentiment</button>
        <button class="tab-btn" data-tab="final">ğŸ“„ Final MoM</button>
      </div>

      <div class="tab-content" id="transcript">
        <h3>Meeting Transcript</h3>
        <p class="muted">Transcript will appear here when audio is processed.</p>
        <div class="demo-content">
          <p>ğŸ¤ <strong>Sample Transcript:</strong></p>
          <p>"Welcome everyone to our quarterly review meeting. Today we'll discuss..."</p>
        </div>
      </div>
      
      <div class="tab-content hidden" id="summaryTab">
        <h3>Meeting Summary</h3>
        <p class="muted">AI-generated summary will appear here.</p>
      </div>
      
      <div class="tab-content hidden" id="action">
        <h3>Action Items</h3>
        <p class="muted">Extracted action items will appear here.</p>
      </div>
      
      <div class="tab-content hidden" id="conflictsTab">
        <h3>Conflict Analysis</h3>
        <p class="muted">AI-detected conflicts will appear here.</p>
      </div>
      
      <div class="tab-content hidden" id="sentiment">
        <h3>Sentiment Analysis</h3>
        <p class="muted">Meeting sentiment analysis will appear here.</p>
      </div>

      <div class="tab-content hidden" id="final">
        <h3>Final Minutes of Meeting</h3>
        <textarea id="finalMomEditor" rows="10" placeholder="Final MoM (editable)..."></textarea>
        <div class="panel-actions">
          <a class="btn success" href="{{ url_for('download_mom') }}">ğŸ“¥ Download Final MoM (.docx)</a>
          <button class="btn ghost" id="copyFinal">ğŸ“‹ Copy Final</button>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- Add Task Form (Hidden by default) -->
<form id="addTaskForm" method="POST" action="{{ url_for('add_task') }}" style="display: none;">
  <input type="hidden" name="person" id="hidden_task_person">
  <input type="hidden" name="task" id="hidden_task_description">
  <input type="hidden" name="deadline" id="hidden_task_deadline">
  <input type="hidden" name="notes" id="hidden_task_notes">
</form>

<!-- Add Conflict Form (Hidden by default) -->
<form id="addConflictForm" method="POST" action="{{ url_for('add_conflict') }}" style="display: none;">
  <input type="hidden" name="issue" id="hidden_conf_issue">
  <input type="hidden" name="raised_by" id="hidden_conf_raised_by">
  <input type="hidden" name="severity" id="hidden_conf_severity">
  <input type="hidden" name="resolution" id="hidden_conf_resolution">
</form>

<script>
// Task form handling
document.getElementById('addTaskBtn').addEventListener('click', function() {
  const person = document.getElementById('task_person').value;
  const task = document.getElementById('task_description').value;
  const deadline = document.getElementById('task_deadline').value;
  
  if (!person || !task) {
    alert('Please fill in both assignee and task description');
    return;
  }
  
  // Set hidden form values and submit
  document.getElementById('hidden_task_person').value = person;
  document.getElementById('hidden_task_description').value = task;
  document.getElementById('hidden_task_deadline').value = deadline;
  document.getElementById('addTaskForm').submit();
});

// Conflict form handling
document.getElementById('addConflictBtn').addEventListener('click', function() {
  const issue = document.getElementById('conf_issue').value;
  const raisedBy = document.getElementById('conf_raised_by').value;
  const severity = document.getElementById('conf_severity').value;
  
  if (!issue || !raisedBy) {
    alert('Please fill in both issue description and raised by');
    return;
  }
  
  // Set hidden form values and submit
  document.getElementById('hidden_conf_issue').value = issue;
  document.getElementById('hidden_conf_raised_by').value = raisedBy;
  document.getElementById('hidden_conf_severity').value = severity;
  document.getElementById('addConflictForm').submit();
});

// Clear form inputs after submission
document.addEventListener('DOMContentLoaded', function() {
  // Clear task inputs
  document.getElementById('task_person').value = '';
  document.getElementById('task_description').value = '';
  document.getElementById('task_deadline').value = '';
  
  // Clear conflict inputs
  document.getElementById('conf_issue').value = '';
  document.getElementById('conf_raised_by').value = '';
});
</script>
{% endblock %}
